<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Upgrading from 0.6.x</title>
    <link rel="icon" type="image/x-icon" href="/marathon/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon/">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/resources.html">Resources</a>
                  </li>
                  <li >
                    <a href="/marathon/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/docs/artifact-store.html">
                    Artifact Store
                </a>
            </li>
            <li>
                <a href="/marathon/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ip-per-task.html">
                    IP-per-task
                </a>
            </li>
            <li>
                <a href="/marathon/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ports.html">
                    Ports
                </a>
            </li>
            <li>
                <a href="/marathon/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/native-docker.html">
                    Running Docker Containers
                </a>
            </li>
            <li>
                <a href="/marathon/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/docs/upgrade/index.html">
                    Upgrading
                </a>
            </li>
            <li>
                <a href="/marathon/docs/upgrade/06xto070.html">
                    Upgrading from 0.6.x
                </a>
            </li>
            <li>
                <a href="/marathon/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/docs/upgrade/versioning.html">
                    Versioning
                </a>
            </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/waiting.html">
                    An App Does Not Leave "Waiting"
                </a>
            </li>
            <li>
                <a href="/marathon/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/docs/generated/api.html">REST API Reference</a>
        </li>

        <li><a href="/marathon/docs/rest-api.html">REST API Reference (deprecated)</a></li>

        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="upgrading-from-0-6-x">Upgrading from 0.6.x</h1>

<p>Upgrading to Marathon 0.7.0 is straight forward if you haven&#39;t been using 
any of the Docker features.</p>

<p>We recommend creating a backup of the ZooKeeper state before upgrading to be able to downgrade in case
of problems after an upgrade. This can done by creating a copy of ZooKeeper&#39;s <a href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html#The+Data+Directory">data directory</a>.</p>

<h2 id="mesos">Mesos</h2>

<p>Marathon will run with either Mesos 0.19.x or Mesos 0.20.0.  However to leverage
the new Docker features Mesos 0.20.0 is required.</p>

<h2 id="v1-api">v1 API</h2>

<p>The v1 API has been removed from Marathon. See <a href="/marathon/docs/rest-api.html">REST API</a> for up to
date documentation of the REST API.</p>

<h2 id="task-rate-limit">Task Rate Limit</h2>

<p>The <code>taskRateLimit</code> app parameter has been replaced with two new parameters
that together control per-app exponential backoff.  The new parameters are
<code>backoffSeconds</code> and  <code>backoffFactor</code>.  The backoff period (<code>backoffSeconds</code>)
is multiplied by the factor for each consecutive failed task launch.</p>

<h2 id="haproxy-bridge">HAProxy Bridge</h2>

<p>Make sure you&#39;re using the latest version of the script, as <code>/v1/endpoints</code>
no longer available.</p>

<h2 id="deployment-design">Deployment Design</h2>

<p>There is a new set of features specifically dedicated to deploying your app.
Your app will automatically be updated to make use of these features.
See the <a href="/marathon/docs/deployment-design-doc.html">full docs</a> for details.</p>

<h2 id="artifact-store">Artifact Store</h2>

<p>Marathon now has support for configuring an artifact cache that can be used 
when deploying your app, this facilitates removing load from package servers
and shifts the load to something like HDFS.
See the <a href="/marathon/docs/artifact-store.html">full docs</a> for details.</p>

<h2 id="docker">Docker</h2>

<p>See <a href="/marathon/docs/native-docker.html">Running Docker Containers on Marathon</a>
for full documentation.</p>

<h3 id="updating-from-deimos">Updating from Deimos</h3>

<p><div class="alert alert-warning">
    <strong>Careful:</strong> Deimos supported the fetching of <code>s3</code> URLs using the
    <code>aws</code> commandline tool and IAM roles, mesos only supports <code>s3</code> URLs if HDFS 
    is also running on the slave. Using the <code>https</code> URL for the resource will not
    take IAM roles into account.
  </div></p>

<ol>
<li><p>Remove Deimos slave configuration</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">rm /etc/mesos-slave/containerizer_path
rm /etc/mesos-slave/isolation
rm /etc/deimos.cfg
</code></pre></div></li>
<li><p>Uninstall Deimos</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">pip uninstall deimos
</code></pre></div></li>
<li><p>Restart <code>mesos-slave</code> process to load the new configuration</p></li>
</ol>

<h3 id="new-container-format">New container format</h3>

<p>The old container format has been replaced with a new format.
Therefore the following changes are <strong>obligatory</strong> for Marathon users
upgrading to <code>0.7.x</code> who were previously using
<a href="https://github.com/mesosphere/deimos">Deimos</a> to run Docker containers.</p>

<p>Previously, the <code>container</code> field looked like this:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;docker:///megacorp/product:1.2.3&quot;</span><span class="p">,</span>
    <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/data/a:/etc/a:ro&quot;</span><span class="p">,</span>
      <span class="s2">&quot;-v&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/data/b:/etc/b:rw&quot;</span><span class="p">,</span>
      <span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;FOO=bar&quot;</span><span class="p">,</span>
      <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;443:443&quot;</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Here is the <code>container</code> field, translated to the new format:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;container&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DOCKER&quot;</span><span class="p">,</span>
    <span class="nt">&quot;docker&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;megacorp/product:1.2.3&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;volumes&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;hostPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/data/a&quot;</span><span class="p">,</span>
        <span class="nt">&quot;containerPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/a&quot;</span><span class="p">,</span>
        <span class="nt">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;RO&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;hostPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/data/b&quot;</span><span class="p">,</span>
        <span class="nt">&quot;containerPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/etc/b&quot;</span><span class="p">,</span>
        <span class="nt">&quot;mode&quot;</span><span class="p">:</span> <span class="s2">&quot;RW&quot;</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">&quot;env&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;FOO&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;ports&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">443</span><span class="p">],</span>
  <span class="nt">&quot;requirePorts&quot;</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="resources">Resources</h2>

<ul>
<li><a href="/marathon/docs/native-docker.html">Native Docker Containers with Mesos and Marathon</a></li>
<li><a href="http://mesos.apache.org/documentation/latest/docker-containerizer/">Mesos Docker Containerizer</a></li>
<li><a href="http://tnachen.wordpress.com/2014/08/19/docker-in-mesos-0-20/">Docker on Mesos 0.20</a></li>
</ul>

    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2016 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  </body>
</html>
