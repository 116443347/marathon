<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: IP-per-task</title>
    <link rel="icon" type="image/x-icon" href="/marathon/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon/">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/resources.html">Resources</a>
                  </li>
                  <li >
                    <a href="/marathon/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/docs/artifact-store.html">
                    Artifact Store
                </a>
            </li>
            <li>
                <a href="/marathon/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ip-per-task.html">
                    IP-per-task
                </a>
            </li>
            <li>
                <a href="/marathon/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ports.html">
                    Ports
                </a>
            </li>
            <li>
                <a href="/marathon/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/native-docker.html">
                    Running Docker Containers
                </a>
            </li>
            <li>
                <a href="/marathon/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/docs/upgrade/index.html">
                    Upgrading
                </a>
            </li>
            <li>
                <a href="/marathon/docs/upgrade/06xto070.html">
                    Upgrading from 0.6.x
                </a>
            </li>
            <li>
                <a href="/marathon/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/docs/upgrade/versioning.html">
                    Versioning
                </a>
            </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/waiting.html">
                    An App Does Not Leave "Waiting"
                </a>
            </li>
            <li>
                <a href="/marathon/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/docs/generated/api.html">REST API Reference</a>
        </li>

        <li><a href="/marathon/docs/rest-api.html">REST API Reference (deprecated)</a></li>

        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="ip-per-task">IP-per-task</h1>

<div class="alert alert-danger" role="alert">
  <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> Available in Marathon Version 0.14.0+ <br/>
    IP-per-task functionality is considered experimental, so use this
    feature at your own risk. We might add, change, or delete any
    functionality described in this document, including the API. We
    appreciate <a href="https://github.com/mesosphere/marathon/issues/2709">your feedback</a>!
</div>

<p>In version 0.14, Marathon introduced experimental IP-per-task support. With the appropriate configuration,
each of an app&#39;s tasks gets its own network interface and IP address.</p>

<p>IP-per-task drastically simplifies service discovery, since you can use
<a href="https://github.com/mesosphere/mesos-dns">Mesos-DNS</a> to rely on DNS for service discovery. Mesos-DNS enables your
applications to use address-only (A) DNS records in combination with known ports to connect to other
services, as you would do it in a traditional static cluster environment.</p>

<p>Request an IP-per-task with default settings by adding the following to your application definition:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/i-have-my-own-ip&quot;</span><span class="p">,</span>
  <span class="err">//</span> <span class="err">...</span> <span class="err">more</span> <span class="err">settings</span> <span class="err">...</span>
  <span class="nt">&quot;ipAddress&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>
<p>Marathon passes down the request for the IP to Mesos. You have to make sure that you installed and configured
the appropriate
<a href="https://docs.google.com/document/d/17mXtAmdAXcNBwp_JfrxmZcQrs7EO6ancSbejrqjLQ0g">Network Isolation Modules</a> and
IP Access Manager (IPAM) modules in Mesos. Marathon support for this feature requires Mesos v0.26.</p>

<p>If an application requires IP-per-task, it cannot request ports to be allocated in the agent node.</p>

<p>Currently, this feature does not work in combination with Docker containers. We might still change some
aspects of the API and we appreciate your feedback.</p>

<h2 id="network-security-groups">Network security groups</h2>

<p>If your IP Access Manager (IPAM) supports it, you can refine your IP configuration using network security
groups and labels:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;/i-have-my-own-ip&quot;</span><span class="p">,</span>
  <span class="c1">// ... more settings ...</span>
  <span class="s2">&quot;ipAddress&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;groups&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;production&quot;</span><span class="p">],</span>
    <span class="s2">&quot;labels&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;some-meaningful-config&quot;</span><span class="o">:</span> <span class="s2">&quot;potentially interpreted by the IPAM&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Network security groups only allow network traffic between tasks that have at least one of their configured
groups in common. This makes it easy to disallow your staging environment to interfere with production
traffic.</p>

<h2 id="named-networks">Named Networks</h2>

<p>If your IPAM supports it, you can instruct Mesos to associate your application&#39;s containers with a specific named network:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;/task-assigned-to-named-network&quot;</span><span class="p">,</span>
  <span class="p">...</span>
  <span class="s2">&quot;ipAddress&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;networkName&quot;</span><span class="o">:</span> <span class="s2">&quot;devops&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Applications that specify a named network are automatically assigned an IP address, for each task, by the currently configured IPAM.
Named network assignment is influenced by the <code>--default_network_name</code> flag: if a default network name has been configured then:</p>

<ol>
<li>An application that specifies an <code>ipAddress</code> but not its <code>networkName</code> field will implicity use the network named by <code>--default_network_name</code>.</li>
<li>An application that specifies an <code>ipAddress.networkName</code> value overrides any value of <code>--default_network_name</code>.</li>
<li>If an application MUST use the <strong>physical host network</strong> then the <code>ipAddress</code> field MUST be omitted from the application definition.</li>
</ol>

<p>Marathon passes the network name through to Mesos and is the responsibility of Mesos (and/or the loaded IPAM modules) to validate the network name.</p>

<h2 id="service-discovery">Service Discovery</h2>

<p>While an application that requires IP-per-task cannot request that ports be allocated in the agent node, you can still specify the ports that the application&#39;s tasks expose:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/i-have-my-own-ip&quot;</span><span class="p">,</span>
  <span class="err">//</span> <span class="err">...</span> <span class="err">more</span> <span class="err">settings</span> <span class="err">...</span>
  <span class="nt">&quot;ipAddress&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;discovery&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;ports&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="nt">&quot;number&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="nt">&quot;protocol&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
      <span class="err">//</span> <span class="err">...</span> <span class="err">more</span> <span class="err">settings</span> <span class="err">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Marathon will pass this information to Mesos (inside the DiscoveryInfo message) when starting new tasks. <a href="https://github.com/mesosphere/mesos-dns">Mesos-DNS</a> will then expose this information through IN SRV records.</p>

    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2016 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  </body>
</html>
