<!DOCTYPE html>
<html lang="en">
  <head>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Framework ID registration</title>
    <link rel="icon" type="image/x-icon" href="/marathon/1.8/img/marathon-favicon.ico">
    <link href="//cdn.jsdelivr.net/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/1.8/css/style.css" rel="stylesheet">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-45222428-4', 'auto');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/marathon">Marathon</a>
              </div>
              <div class="collapse navbar-collapse" id="navbar-collapse">
                <ul class="nav navbar-nav">
                  <li class="active">
                    <a href="/marathon/1.8/docs/">Docs</a>
                  </li>
                  <li >
                    <a href="/marathon/1.8/support.html">Support</a>
                  </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
                </ul>
                <div class="grid" id="searchBar">
                  <div id="search">
                    <form role="search" method="get" action="/marathon/1.8/search/">
                      <input id="searchString" name="searchString"
                             placeholder="Search Marathon Docs" type="text">
                      <input id="searchButton" name="googleSearchName" type="submit" value="Search">
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
    <div class="col-sm-3">

        <h5>Getting Started</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.8/docs/">
                    Install Marathon
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/setup.html">
                    Setup Recommendations
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/high-availability.html">
                    High Availability Mode
                </a>
            </li>
        </ul>

        <h5>Using Marathon</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.8/docs/application-basics.html">
                    Application Basics
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/deployments.html">
                    Application Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/application-groups.html">
                    Application Groups
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/auth-access-ctrl.html">
                    Authorization and Access Control
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/blue-green-deploy.html">
                    Blue-Green Deployment
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/constraints.html">
                    Constraints
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/event-bus.html">
                    Event Bus
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/health-checks.html">
                    Health Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/marathon-ui.html">
                    Marathon Web Interface
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/networking.html">
                    Networking
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/pods.html">
                    Pods
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/recipes.html">
                    Recipes
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/native-docker.html">
                    Provisioning Containers
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/persistent-volumes.html">
                    Stateful Applications Using Local Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/external-volumes.html">
                    Stateful Applications Using External Persistent Volumes
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/task-environment-vars.html">
                    Task Environment Variables
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/task-handling.html">
                    Task Handling
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/configure-task-handling.html">
                    Task Handling Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/secrets.html">
                    Secret Configuration
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/unreachable.html">
                    Unreachable Strategy
                </a>
            </li>
        </ul>

        <h5>Administration</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.8/docs/command-line-flags.html">
                    Command Line Flags
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/backup-restore.html">
                    Backup and Restore
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/data-migration.html">
                    Data Migration
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/framework-authentication.html">
                    Framework Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/high-availability.html">
                    High Availability
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/metrics.html">
                    Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/deprecated-metrics.html">
                    Deprecated Metrics
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/readiness-checks.html">
                    Readiness Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/checks.html">
                    Checks
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/service-discovery-load-balancing.html">
                    Service Discovery and Load Balancing
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/ssl-basic-access-authentication.html">
                    SSL and Basic Authentication
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/native-docker-private-registry.html">
                    Using a Private Docker Registry
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/maintenance-mode.html">
                    Maintenance mode
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/mesos-compatibility.html">
                    Compatibility with Mesos
                </a>
            </li>
        </ul>

        <h5>Upgrading</h5>
        <ul class="list-unstyled">
          <li>
              <a href="/marathon/1.8/docs/upgrade/index.html">
                  Upgrading to a new Version
              </a>
          </li>
          <li>
              <a href="/marathon/1.8/docs/upgrade/network-api-for-apps.html">
                  Migrating Apps to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.8/docs/upgrade/network-api-migration.html">
                  Migrating Tools to the 1.5 Networking API
              </a>
          </li>
          <li>
              <a href="/marathon/1.8/docs/upgrade/versioning.html">
                  Versioning
              </a>
          </li>
        </ul>

        <h5>Troubleshooting</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.8/docs/waiting.html">
                   Stuck App or Pod Deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/backoff.html">
                    No new instances are starting
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/host-port.html">
                    An App Requires a Specific Host Port
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/local-cert.html">
                    Error Using HTTPS with local CA Certificate
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/auth-secret.html">
                    Error Reading Authentication Secret
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/cfs.html">
                    Slow Docker apps and deployments
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/exit-codes.html">
                   Exit Codes
                </a>
            </li>
        </ul>

        <h5>Development</h5>
        <ul class="list-unstyled">
            <li>
                <a href="/marathon/1.8/docs/contributing.html">
                    Contributor Guidelines
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/core-architecture.html">
                    Current Marathon Development
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/plugin.html">
                    Extend Marathon with Plugins
                </a>
            </li>
            <li>
                <a href="/marathon/1.8/docs/developing-vm.html">
                    Run a Local Version of Marathon
                </a>
            </li>
        </ul>

        <h5>API Reference</h5>
        <ul class="list-unstyled">
        <li>
            <a href="/marathon/1.8/api-console/index.html">REST API Reference</a>
        </li>
        </ul>
        <h5>Docs for Previous Versions</h5>
        <ul class="list-unstyled">
            
            <li><a href="/marathon/1.8/docs">Version 1.8.x</a></li>
            
            <li><a href="/marathon/1.7/docs">Version 1.7.x</a></li>
            
            <li><a href="/marathon/1.6/docs">Version 1.6.x</a></li>
            
        </ul>
    </div>

    <div class="col-sm-9">
        <h1 id="framework-id-registration">Framework ID registration</h1>
<p>Marathon registers as a framework with Mesos. During the first attempt to connect with Mesos, Marathon requests a new framework ID. This framework ID is used to associate the instance of Marathon with the tasks launched by that instance of Marathon.</p>

<p>It is very important to consistently use the same framework ID. If Marathon changes framework IDs while existing tasks are running, then the old tasks will become effectively orphaned, while a new set of tasks will be launched. Because of this, Marathon will refuse to generate a new framework ID if there are any instances specified. This means that Marathon may not be able to launch under the following cases:</p>

<ul>
  <li>The Zookeeper record containing the Marathon framework ID was removed, is inaccessible, or was corrupted.</li>
  <li>The framework ID associated with the Marathon instance was marked as “torn down” in Mesos, or the framework failover timeout has been exceeded; as a result Marathon cannot reuse its framework ID.</li>
</ul>

<h2 id="recovering-from-framework-id-issues">Recovering from Framework ID issues</h2>

<p>To recover from this, you can use the <a href="https://github.com/mesosphere/marathon-storage-tool">Marathon Storage Tool</a> to repair / update Marathon’s state. Follow the instructions in the README to launch the appropriate version for your Marathon instance, and to provide the appropriate configuration flags.</p>

<h1 id="zookeeper-record-containing-the-marathon-framework-id-was-removedinaccessiblecorrupted">Zookeeper record containing the Marathon framework ID was removed/inaccessible/corrupted</h1>

<p>To repair the Marathon’s framework ID record in Zookeeper, you will need the framework ID as which Marathon should connect. You can get this by accessing the frameworks section of the Mesos UI, or by requesting the framework information JSON state from <code class="highlighter-rouge">{mesos_url}/frameworks</code>.</p>

<p>Launch the Marathon Storage Tool and update the framework ID using the following commands (where <code class="highlighter-rouge">00000000-0000-0000-0000-000000000000-0000</code> is your framework ID):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import mesosphere.util.state.FrameworkId

module.frameworkIdRepository.store(
  FrameworkId("00000000-0000-0000-0000-000000000000-0000"))
</code></pre></div></div>

<p>It is critical that you specify the framework ID exactly as it is registered in Mesos. Be sure that there are no spaces in the ID.</p>

<h1 id="marathon-framework-was-torn-down-in-mesos">Marathon Framework was torn down in Mesos</h1>

<p>In this case, Mesos is marked a framework as gone, and a new framework ID will need to be generated. Since Marathon will refuse to generate a new framework ID if instances are defined, you will need to delete all instances, in addition to deleting the framework ID record. All service state (apps, pods, groups, etc.) will be preserved.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>purge(listInstances())

module.frameworkIdRepository.delete()
</code></pre></div></div>

<p>Quit the Marathon Storage Tool, and restart Marathon. Marathon will generate a new framework ID on launch.</p>

<p>Note that old reservations for persistent tasks launched by the old framework ID will not be reused, nor will they be cleaned up. You’ll need to manually destroy these reservations using the Mesos API.</p>

    </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2018 <a class="text-muted" href="http://mesosphere.com">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
    <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdn.jsdelivr.net/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="//cdn.jsdelivr.net/anchorjs/3.2.2/anchor.min.js"></script>
    <script>
        (function () {
            'use strict';
            anchors.options.placement = 'right';
            anchors.add('h2, h3, h4, h5, h6');
        })();
    </script>
  </body>
</html>