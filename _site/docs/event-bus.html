<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Event Bus</title>
    <link rel="icon" type="image/x-icon" href="/marathon/img/marathon-favicon.ico">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/css/style.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <a class="navbar-brand" href="/marathon/">Marathon</a>
              </div>
              <ul class="nav navbar-nav">
                <li><a href="/marathon/docs/">Docs</a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
              </ul>
            </div>
          </div>
          <div class="row">
  <div class="col-sm-3">
    <h5>Welcome</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/">
          Getting Started
        </a>
      </li>
    </ul>
    <hr>
    <h5>Guides</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/service-discovery-load-balancing.html">
          Discovery &amp; Load Balancing
        </a>
      </li>
    </ul>
    <hr>
    <h5>Reference</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/artifact-store.html">
          Artifact Store
        </a>
      </li>
      <li>
        <a href="/marathon/docs/command-line-flags.html">
          Command Line Flags
        </a>
      </li>
      <li>
        <a href="/marathon/docs/constraints.html">
          Constraints
        </a>
      </li>
      <li>
        <a href="/marathon/docs/event-bus.html">
          Event Bus
        </a>
      </li>
      <li>
        <a href="/marathon/docs/health-checks.html">
          Health Checks
        </a>
      </li>
      <li>
        <a href="/marathon/docs/rest-api.html">
          REST API
        </a>
      </li>
    </ul>
    <hr>
    <h5>Resources</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/deployment-design-doc.html">
          Deployment Design
        </a>
      </li>
    </ul>
  </div>
  <div class="col-sm-9">
    <h1 id="event-bus">Event Bus</h1>

<p>Marathon has an internal event bus that captures all API requests and scaling events. This is useful for integrating with load balancers, keeping stats, etc.
Events can be subscribed to by pluggable subscribers. Currently an HTTP callback subscriber is implemented that POSTs events in JSON format to one or more endpoints. Other subscribers are easy to add. See the code in
<a href="https://github.com/mesosphere/marathon/tree/master/src/main/scala/mesosphere/marathon/event/http">marathon/event/http</a>
for guidance.</p>

<h2 id="configuration">Configuration</h2>

<p>Add these command line options to configure events:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./bin/start --master ... --event_subscriber http_callback --http_endpoints http://host1/foo,http://host2/bar
</code></pre></div>
<p>Both host1 and host2 will receive events.</p>

<h2 id="event-types">Event Types</h2>

<p>Below are example JSON bodies that are posted by Marathon.</p>

<h3 id="api-request">API Request</h3>

<p>Fired every time Marathon receives an API request that modifies an app (create, update, delete):</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;eventType&quot;</span><span class="p">:</span> <span class="s2">&quot;api_post_event&quot;</span><span class="p">,</span>
  <span class="nt">&quot;clientIp&quot;</span><span class="p">:</span> <span class="s2">&quot;0:0:0:0:0:0:0:1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/v1/apps/start&quot;</span><span class="p">,</span>
  <span class="nt">&quot;appDefinition&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;sleep&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;sleep 10&quot;</span><span class="p">,</span>
    <span class="nt">&quot;env&quot;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="nt">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
    <span class="nt">&quot;executor&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;ports&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">14480</span><span class="p">],</span>
    <span class="nt">&quot;taskRateLimit&quot;</span><span class="p">:</span> <span class="mf">1.0</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="status-update">Status Update</h3>

<p>Fired every time the status of a task changes:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;eventType&quot;</span><span class="p">:</span> <span class="s2">&quot;status_update_event&quot;</span><span class="p">,</span>
  <span class="nt">&quot;taskId&quot;</span><span class="p">:</span> <span class="s2">&quot;sleep_0-1389757007517&quot;</span><span class="p">,</span>
  <span class="nt">&quot;taskStatus&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nt">&quot;appID&quot;</span><span class="p">:</span> <span class="s2">&quot;sleep&quot;</span><span class="p">,</span>
  <span class="nt">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;zwerg&quot;</span><span class="p">,</span>
  <span class="nt">&quot;ports&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31372</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
  </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2014 <a class="text-muted" href="http://mesosphere.io">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>
