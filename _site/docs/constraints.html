<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Constraints</title>
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/css/style.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <a class="navbar-brand" href="/marathon/">Marathon</a>
              </div>
              <ul class="nav navbar-nav">
                <li><a href="/marathon/docs/">Docs</a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
              </ul>
            </div>
          </div>
          <div class="row">
  <div class="col-sm-3">
    <h5>Welcome</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/">
          Getting Started
        </a>
      </li>
    </ul>
    <hr>
    <h5>Guides</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/service-discovery-load-balancing.html">
          Discovery &amp; Load Balancing
        </a>
      </li>
    </ul>
    <hr>
    <h5>Reference</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/artifact-store.html">
          Artifact Store
        </a>
      </li>
      <li>
        <a href="/marathon/docs/command-line-flags.html">
          Command Line Flags
        </a>
      </li>
      <li>
        <a href="/marathon/docs/constraints.html">
          Constraints
        </a>
      </li>
      <li>
        <a href="/marathon/docs/event-bus.html">
          Event Bus
        </a>
      </li>
      <li>
        <a href="/marathon/docs/health-checks.html">
          Health Checks
        </a>
      </li>
      <li>
        <a href="/marathon/docs/rest-api.html">
          REST API
        </a>
      </li>
    </ul>
    <hr>
    <h5>Resources</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/deployment-design-doc.html">
          Deployment Design
        </a>
      </li>
    </ul>
  </div>
  <div class="col-sm-9">
    <h1 id="constraints">Constraints</h1>

<p>Constraints control where apps run to allow optimizing for fault tolerance or locality.
Constraints can be set via the REST API or the <a href="https://rubygems.org/gems/marathon_client">Marathon gem</a> when starting an app. Make sure to use the gem version 0.2.0 or later for constraint support. Constraints are made up of three parts: a field name, an operator, and an optional value. The field can be the slave hostname or any Mesos slave attribute.</p>

<h3 id="unique-operator">UNIQUE operator</h3>

<p><code>UNIQUE</code> tells Marathon to enforce uniqueness of the attribute across all of an app&#39;s tasks. For example the following constraint ensures that there is only one app task running on each host:</p>

<p>via the Marathon gem:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>marathon start -i sleep -C <span class="s1">&#39;sleep 60&#39;</span> -n <span class="m">3</span> --constraint hostname:UNIQUE
</code></pre></div>
<p>via curl:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -X POST -H <span class="s2">&quot;Content-type: application/json&quot;</span> localhost:8080/v1/apps/start -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;id&quot;: &quot;sleep-unique&quot;,</span>
<span class="s1">    &quot;cmd&quot;: &quot;sleep 60&quot;,</span>
<span class="s1">    &quot;instances&quot;: 3,</span>
<span class="s1">    &quot;constraints&quot;: [[&quot;hostname&quot;, &quot;UNIQUE&quot;]]</span>
<span class="s1">  }&#39;</span>
</code></pre></div>
<h3 id="cluster-operator">CLUSTER operator</h3>

<p><code>CLUSTER</code> allows you to run all of your app&#39;s tasks on slaves that share a certain attribute. This is useful for example if you have apps with special hardware needs, or if you want to run them on the same rack for low latency.</p>

<p>via the Marathon gem:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>marathon start -i sleep -C <span class="s1">&#39;sleep 60&#39;</span> -n <span class="m">3</span> --constraint rack_id:CLUSTER:rack-1
</code></pre></div>
<p>via curl:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -X POST -H <span class="s2">&quot;Content-type: application/json&quot;</span> localhost:8080/v1/apps/start -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;id&quot;: &quot;sleep-cluster&quot;,</span>
<span class="s1">    &quot;cmd&quot;: &quot;sleep 60&quot;,</span>
<span class="s1">    &quot;instances&quot;: 3,</span>
<span class="s1">    &quot;constraints&quot;: [[&quot;rack_id&quot;, &quot;CLUSTER&quot;, &quot;rack-1&quot;]]</span>
<span class="s1">  }&#39;</span>
</code></pre></div>
<p>You can also use this attribute to tie an application to a specific node by using the hostname property:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -X POST -H <span class="s2">&quot;Content-type: application/json&quot;</span> localhost:8080/v1/apps/start -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;id&quot;: &quot;sleep-cluster&quot;,</span>
<span class="s1">    &quot;cmd&quot;: &quot;sleep 60&quot;,</span>
<span class="s1">    &quot;instances&quot;: 3,</span>
<span class="s1">    &quot;constraints&quot;: [[&quot;hostname&quot;, &quot;CLUSTER&quot;, &quot;a.specific.node.com&quot;]]</span>
<span class="s1">  }&#39;</span>
</code></pre></div>
<h3 id="group_by-operator">GROUP_BY operator</h3>

<p><code>GROUP_BY</code> can be used to distribute tasks evenly across racks or datacenters for high availability.</p>

<p>via the Marathon gem:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>marathon start -i sleep -C <span class="s1">&#39;sleep 60&#39;</span> -n <span class="m">3</span> --constraint rack_id:GROUP_BY
</code></pre></div>
<p>via curl:</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>curl -X POST -H <span class="s2">&quot;Content-type: application/json&quot;</span> localhost:8080/v1/apps/start -d <span class="s1">&#39;{</span>
<span class="s1">    &quot;id&quot;: &quot;sleep-group-by&quot;,</span>
<span class="s1">    &quot;cmd&quot;: &quot;sleep 60&quot;,</span>
<span class="s1">    &quot;instances&quot;: 3,</span>
<span class="s1">    &quot;constraints&quot;: [[&quot;rack_id&quot;, &quot;GROUP_BY&quot;]]</span>
<span class="s1">  }&#39;</span>
</code></pre></div>
<p>Optionally, you can specify a minimum number of groups to try and achieve.</p>

  </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2014 <a class="text-muted" href="http://mesosphere.io">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>
