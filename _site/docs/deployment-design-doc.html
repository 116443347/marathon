<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Marathon: Advanced Deployment Design</title>
    <link rel="icon" type="image/x-icon" href="/marathon/img/marathon-favicon.ico">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="/marathon/css/style.css" rel="stylesheet">
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
          <div class="navbar navbar-default navbar-inverse" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <a class="navbar-brand" href="/marathon/">Marathon</a>
              </div>
              <ul class="nav navbar-nav">
                <li><a href="/marathon/docs/">Docs</a></li>
              </ul>
              <ul class="nav navbar-nav navbar-right">
                <li><a href="https://github.com/mesosphere/marathon">GitHub</a></li>
              </ul>
            </div>
          </div>
          <div class="row">
  <div class="col-sm-3">
    <h5>Welcome</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/">
          Getting Started
        </a>
      </li>
    </ul>
    <hr>
    <h5>Guides</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/service-discovery-load-balancing.html">
          Discovery &amp; Load Balancing
        </a>
      </li>
    </ul>
    <hr>
    <h5>Reference</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/artifact-store.html">
          Artifact Store
        </a>
      </li>
      <li>
        <a href="/marathon/docs/command-line-flags.html">
          Command Line Flags
        </a>
      </li>
      <li>
        <a href="/marathon/docs/constraints.html">
          Constraints
        </a>
      </li>
      <li>
        <a href="/marathon/docs/event-bus.html">
          Event Bus
        </a>
      </li>
      <li>
        <a href="/marathon/docs/health-checks.html">
          Health Checks
        </a>
      </li>
      <li>
        <a href="/marathon/docs/rest-api.html">
          REST API
        </a>
      </li>
    </ul>
    <hr>
    <h5>Resources</h5>
    <ul class="list-unstyled">
      <li>
        <a href="/marathon/docs/deployment-design-doc.html">
          Deployment Design
        </a>
      </li>
    </ul>
  </div>
  <div class="col-sm-9">
    <h1 id="advanced-deployment-with-marathon">Advanced Deployment with Marathon</h1>

<h2 id="problem-statement">Problem Statement</h2>

<p>One of the most common problems facing developers and operators is how to roll out new versions of applications uninterruptibly.  At the root, this process consists of two phases: starting a set of processes, and stopping a (disjoint) set of processes.  The details of how these phases are executed in a multi-datacenter environment may vary wildly from site to site.  For example, these phases may or may not happen concurrently.  Additional restrictions may apply, such as how long to wait before traffic is routed to a newly created process.  Another typical aspect of this task is the configuration of external systems, such as reverse proxies for load balancing.</p>

<p>In the Apache Mesos model, where process placement is typically done dynamically, these configuration tasks must happen in response to the resource allocator and scheduler.  The purpose of this exercise is to explore what features Marathon can provide to ease the entire deployment process, including the configuration of supporting systems.  Marathon&#39;s current feature set is opinionated regarding how to implement custom application provisioning logic -- that is, Marathon provides useful primitives that can be composed to solve a wide variety of problems.  Marathon exposes this functionality through a simple <em>RESTful</em> HTTP interface to maximize scriptability from programming languages already in wide use for operations automation.</p>

<h2 id="example-use-cases">Example Use Cases</h2>

<h3 id="rolling-restart">Rolling restart</h3>

<ul>
<li><p>Given that <code>N</code> instances of an application are currently running in the
cluster, restart them</p></li>
<li><p>Ensure that there are at least <code>k</code> percent healthy instances available for servicing
requests at all times</p></li>
<li><p>Allow for dynamic reconfiguration of load balancers such that no production
traffic is routed to a down instance</p></li>
</ul>

<h3 id="rolling-upgrade">Rolling upgrade</h3>

<ul>
<li><p>Similar to a rolling restart (outlined above)</p></li>
<li><p>Operators should be able to control the transition strategy</p>

<ul>
<li><p>An example transition strategy:</p>

<ul>
<li>Bring up the full complement of new application instances</li>
<li>Optionally wait for health checks to pass on new instances before redirecting traffic</li>
<li>Reconfigure load balancers to direct traffic to the new instances</li>
<li>Optionally wait before killling old instances in case of a rollback</li>
<li>Kill all of the old application instances</li>
</ul></li>
<li><p>Another strategy:</p>

<ul>
<li><p>Bring up new instances one-at-a-time</p>

<ul>
<li>As each instance comes up, add it to the load balancer</li>
<li>Remove an old instance from the load balancer before killing it</li>
</ul></li>
</ul></li>
<li><p>Yet another strategy:</p>

<ul>
<li>Bring up new instances incrementally in batches, e.g. <em>5%, 25%, 100%</em></li>
<li>Perform health checks on each batch, rolling back on failure</li>
<li>On successfully deploying all batches of the new version, transition traffic
over to the new instances gradually via load balancer configuration</li>
</ul></li>
</ul></li>
</ul>

<h2 id="proposed-new-features">Proposed New Features</h2>

<h3 id="task-health-checks">Task health checks</h3>

<ul>
<li><p>Health checks may be specified per applicaiton, to be run against that application&#39;s tasks.</p></li>
<li><p>The default health check defers to Mesos&#39; knowledge of the task state<br>
<code>TASK_RUNNING =&gt; healthy</code></p></li>
<li><p>Initially, HTTP and TCP health checks are supported.</p></li>
<li><p>Marathon in turn provides a <code>health</code> member of the task resource
via the <em>REST</em> API.</p></li>
<li><p>Health checks begin immediately after the process is up, but failures are ignored within <code>gracePeriodSeconds</code>, until a task becomes healthy for the first time.</p></li>
<li><p>Tasks that do not become healthy after <code>maxConsecutiveFailures</code> are killed.</p></li>
<li><p>A health check definition looks like this:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
  <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/health&quot;</span><span class="p">,</span>
  <span class="nt">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="nt">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span>
  <span class="nt">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="nt">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
  <span class="nt">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>The application health lifecycle is represented by the finite state machine in figure 1 below.  In the diagram:</p>

<ul>
<li><code>i</code> is the number of requested instances</li>
<li><code>r</code> is the number of running instances</li>
<li><code>h</code> is the number of healthy instances</li>
</ul>

<p><img src="/marathon/img/app-state.png" alt="lifecycle" title="Application health lifecycle"><br>
Figure 1: The Application Health Lifecycle</p></li>
</ul>

<h3 id="immutable-application-definitions">Immutable application definitions</h3>

<ul>
<li><p>This allows apps to be properly versioned and opens the door to rollbacks</p></li>
<li><p>Versions are derived from time stamps and exposed to users in human-friendly
ISO date format</p></li>
</ul>

<h3 id="hierarchical-groups">Hierarchical Groups</h3>

<ul>
<li><p>We propose a new user-defined n-ary tree of groups, with applications as leaves.
  Groups are versioned, like applications.</p></li>
<li><p>Groups may contain groups or apps (but not both)</p></li>
<li><p>There is one root group at <code>/v2/groups/</code></p></li>
<li><p>The definition of a simple (empty) group looks like this:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test&quot;</span> <span class="p">}</span>
</code></pre></div></li>
<li><p>The definition of a group looks like this if it contains groups:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test&quot;</span>
  <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test/product-a&quot;</span>
      <span class="err">...</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>The definition of a group looks like this if it contains apps:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test/product-a&quot;</span><span class="p">,</span>
  <span class="nt">&quot;apps&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test/product-a/rails-frontend-1.3.2&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf rails*.tgz &amp;&amp; start-postgres.sh&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
      <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
      <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;http://artifacts.mycompany.com/product-a/rails-frontend-1.3.2.tgz&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test/product-a/pg-backend-2.5.7&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf pg*.tgz &amp;&amp; start-postgres.sh&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
      <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;http://artifacts.mycompany.com/product-a/pg-backend-2.5.7.tgz&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>

<h3 id="dependencies">Dependencies</h3>

<ul>
<li><p>The API will allow clients to declare that an entity (a group or an application)
&quot;depends on&quot; another entity.</p>

<ul>
<li>The &quot;depends on&quot; relationships are used in part to determine the health of the entity</li>
<li>The &quot;depends on&quot; relationships are used to manage scaling or restart of the namespace subtree.</li>
<li><p>Dependencies are specified as follows:</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/test/product-a/frontend&quot;</span><span class="p">,</span>
  <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/test/product-a/backend&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></li>
<li><p>Figure 2 (below) illustrates a simple group hierarchy with a single dependency
defined.</p></li>
</ul>

<p><img src="/marathon/img/apps.png" alt="hierarchy" title="Namespaced Application Groups with a Dependency"><br>
  Figure 2: Namespaced Application Groups with a Dependency</p></li>
</ul>

<h3 id="managed-scaling">Managed Scaling</h3>

<ul>
<li><p>There is an endpoint that updates the instances parameter of each descendent application, maintaining the relative ratios among the
members and taking into account inter-group dependencies</p></li>
<li><p><strong>TODO</strong>: <em>More clearly define scaling semantics</em></p></li>
</ul>

<h3 id="richer-api-support-for-events">Richer API support for events</h3>

<ul>
<li><p>New <em>REST</em> endpoint for per-app event streams (chunked transfer), newline-delimited</p></li>
<li><p>This is both more granular and more amenable to consumption by
simple scripts than the currently supported web hook</p></li>
</ul>

<h4 id="overview-of-proposed-api-examples">Overview of Proposed API Examples</h4>

<h5 id="create-an-app">Create an App</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/apps/product-a/frontend/play
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf *.tgz &amp;&amp; bin/start-play.sh&quot;</span><span class="p">,</span>
  <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http://artifacts.acme.com/rel/app-1.2.3.tgz&quot;</span><span class="p">,</span>
  <span class="nt">&quot;healthChecks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
      <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/health&quot;</span><span class="p">,</span>
      <span class="nt">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;acceptableStatus&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">],</span>
      <span class="nt">&quot;initialDelaySeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
      <span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
      <span class="nt">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">POST /v2/apps/product-a/frontend
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;play&quot;</span><span class="p">,</span>
  <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf *.tgz &amp;&amp; bin/start-play.sh&quot;</span><span class="p">,</span>
  <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http://artifacts.acme.com/rel/app-1.2.3.tgz&quot;</span><span class="p">,</span>
  <span class="nt">&quot;healthChecks&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span>
      <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;/api/health&quot;</span><span class="p">,</span>
      <span class="nt">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nt">&quot;acceptableStatus&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">],</span>
      <span class="nt">&quot;initialDelaySeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
      <span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
      <span class="nt">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>Creating or updating a multitude of apps:  </p>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/apps
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/play&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf *.tgz &amp;&amp; bin/start-play.sh&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http://artifacts.acme.com/rel/app-1.2.3.tgz&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/fun&quot;</span><span class="p">,</span>
    <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf *.tgz &amp;&amp; bin/start-play.sh&quot;</span><span class="p">,</span>
    <span class="nt">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;http://artifacts.acme.com/rel/app-1.2.3.tgz&quot;</span><span class="p">,</span>
    <span class="nt">&quot;healthChecks&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span>
        <span class="nt">&quot;portIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nt">&quot;gracePeriodSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="nt">&quot;timeoutSeconds&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="nt">&quot;maxConsecutiveFailures&quot;</span><span class="p">:</span> <span class="mi">0</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<h5 id="declare-a-dependency">Declare a dependency</h5>

<p>Add the dependency from a group to a group:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/groups/product-a/frontend
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;backend&quot;</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div>
<p>or from an app to a group</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/apps/product-a/frontend/play
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;../backend&quot;</span><span class="p">]</span> <span class="p">}</span>
</code></pre></div>
<h5 id="create-a-group">Create a group</h5>

<p><code>POST</code> or <code>PUT</code> a group anywhere in the hierarchy (behaves like <code>mkdir -p</code> in that any necessary groups are implicitly created)</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">POST /v2/groups/test
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;product-a&quot;</span><span class="p">,</span>
  <span class="nt">&quot;upgradeStrategy&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;minimumHealthCapacity&quot;</span><span class="p">:</span> <span class="mf">0.5</span>
  <span class="p">},</span>
  <span class="nt">&quot;apps&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;rails-frontend-1.3.2&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf rails*.tgz &amp;&amp; start-postgres.sh&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
      <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
      <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;http://artifacts.mycompany.com/productA/rails-frontend-1.3.2.tgz&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;pg-backend-2.5.7&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf pg*.tgz &amp;&amp; start-postgres.sh&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
      <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;http://artifacts.mycompany.com/productA/pg-backend-2.5.7.tgz&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/groups/test/product-a
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;apps&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;rails-frontend-1.3.2&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf rails*.tgz &amp;&amp; start-postgres.sh&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
      <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
      <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;http://artifacts.mycompany.com/product-a/rails-frontend-1.3.2.tgz&quot;</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;pg-backend-2.5.7&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cmd&quot;</span><span class="p">:</span> <span class="s2">&quot;tar -xf pg*.tgz &amp;&amp; start-postgres.sh&quot;</span><span class="p">,</span>
      <span class="nt">&quot;cpus&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="nt">&quot;mem&quot;</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
      <span class="nt">&quot;uris&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;http://artifacts.mycompany.com/product-a/pg-backend-2.5.7.tgz&quot;</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="view-a-group&#39;s-data">View a group&#39;s data</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/groups/product-a/frontend
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;.&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend&quot;</span><span class="p">,</span>
    <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/product-a/backend&quot;</span><span class="p">],</span>
    <span class="nt">&quot;apps&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/play&quot;</span><span class="p">,</span>
        <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span><span class="p">,</span>
        <span class="err">...</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/ehcache&quot;</span><span class="p">,</span>
        <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:13:21.247Z&quot;</span><span class="p">,</span>
        <span class="err">...</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/groups/product-a
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;.&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a&quot;</span><span class="p">,</span>
    <span class="nt">&quot;groups&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend&quot;</span><span class="p">,</span>
        <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/product-a/backend&quot;</span><span class="p">],</span>
        <span class="nt">&quot;apps&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/play&quot;</span><span class="p">,</span>
            <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span><span class="p">,</span>
            <span class="err">...</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/ehcache&quot;</span><span class="p">,</span>
            <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:13:21.247Z&quot;</span><span class="p">,</span>
            <span class="err">...</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="roll-back-to-a-previous-configuration-of-a-group">Roll back to a previous configuration of a group</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/groups/myGroup
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-02-07T02:30Z&quot;</span> <span class="p">}</span>
</code></pre></div>
<h5 id="scale-a-group,-maintaining-relative-instance-ratios-(creates-a-new-version-of-the-group-and-its-apps)">Scale a group, maintaining relative instance ratios (creates a new version of the group and its apps)</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/groups/myGroup
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&quot;scaleBy&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">}</span>
</code></pre></div>
<h5 id="destroy-a-group">Destroy a group</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">DELETE /v2/groups/myGroup
</code></pre></div>
<h5 id="list-apps-at-a-certain-point-in-the-namespace">List apps at a certain point in the namespace</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/apps/product-a/frontend/*
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;*&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/play&quot;</span><span class="p">,</span>
      <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span><span class="p">,</span>
      <span class="err">...</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/ehcache&quot;</span><span class="p">,</span>
      <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:13:21.247Z&quot;</span><span class="p">,</span>
      <span class="err">...</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>OR</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/apps/product-a/*
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&quot;*&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/play&quot;</span><span class="p">,</span>
      <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:29:30.158Z&quot;</span><span class="p">,</span>
      <span class="err">...</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/frontend/ehcache&quot;</span><span class="p">,</span>
      <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:13:21.247Z&quot;</span><span class="p">,</span>
      <span class="err">...</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;/product-a/backend/pgsql&quot;</span><span class="p">,</span>
      <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2014-03-01T23:11:18.937Z&quot;</span><span class="p">,</span>
      <span class="err">...</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<h5 id="update-an-app">Update an app</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">PUT /v2/apps/product-a/frontend/play
</code></pre></div><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span> <span class="nt">&quot;instances&quot;</span><span class="p">:</span> <span class="mi">8</span> <span class="p">}</span>
</code></pre></div>
<h5 id="kill-a-task">Kill a task</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">DELETE /v2/tasks/product-a/frontend/play/task_xxxx?scale=true
</code></pre></div>
<h5 id="get-a-list-of-apps-in-a-subtree">Get a list of apps in a subtree</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/apps/*
GET /v2/apps/product-a/*
GET /v2/apps/product-a/frontend/*
</code></pre></div>
<h5 id="get-a-list-of-tasks-in-a-subtree">Get a list of tasks in a subtree</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/apps/*/task
GET /v2/apps/product-a/*/task
GET /v2/apps/product-a/frontend/*/task
GET /v2/apps/product-a/frontend/play/*/task
</code></pre></div>
<h5 id="check-the-health-of-a-task-(not-implemented)">Check the health of a task (not implemented)</h5>

<p>A task is healthy if its latest health check passed.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/health/product-a/frontend/play/task_xxxx
</code></pre></div>
<h5 id="check-the-health-of-an-app-(not-implemented)">Check the health of an app (not implemented)</h5>

<p>An app&#39;s health is one of [&quot;healthy&quot;, &quot;unhealthy&quot;, &quot;scaling&quot;]</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/health/product-a/frontend/play
</code></pre></div>
<h5 id="check-the-health-of-a-group-(not-implemented)">Check the health of a group (not implemented)</h5>

<p>A group is &quot;healthy&quot; iff all of its apps are healthy.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/health/groups/product-a
</code></pre></div>
<h5 id="list-the-health-of-all-apps-in-a-group-(not-implemented)">List the health of all apps in a group (not implemented)</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/health/groups/product-a/*
</code></pre></div>
<h5 id="get-a-stream-of-events-for-an-app-(not-implemented)">Get a stream of events for an app (not implemented)</h5>
<div class="highlight"><pre><code class="language-text" data-lang="text">GET /v2/events/product-a/frontend/play
</code></pre></div>
  </div>
</div>

          <footer>
            <p class="text-muted">
              &copy; 2014 <a class="text-muted" href="http://mesosphere.io">Mesosphere, Inc.</a>
            </p>
          </footer>
        </div>
      </div>
    </div>
  </body>
</html>
